# LAB 1: 获取任务信息

### 功能总结
通过在 `TaskControlBlock` 中添加**任务初次运行时间**和**系统调用次数**两个字段, 并在任务初次运行时和 `trap_handler` 函数中添加相应处理代码实现了 `sys_task_info` 系统调用的功能, 并通过测试.  

### 简答题

1. 版本: RustSBI 0.3.0-alpha.4  
行为: 三个程序分别触发了 `PageFault`, `IllegalInstruction`, `IllegalInstruction`, 导致内核将其杀死.  

2.  
    (1). 刚进入 `__restore` 时, `a0` 为空上下文的地址. `__restore` 的使用情景有: ① 用于初次启动应用 ② 用于恢复 Trap 上下文.  

    (2). 特殊处理 (写入) 了以下寄存器: `sstatus` 记录了进入 Trap 前的特权等级 (这里为 U), 以待恢复; `spec` 记录了 Trap 发生前执行的最后一条指令的地址, 以便返回到用户态后继续执行指令; `sscratch` 记录了应用栈的栈顶, 以便恢复原 `sp`.  

    (3). 此时 `sp` 指向内核栈, 如果在这里就恢复 `x2 (sp)` 为用户栈栈顶, 则后续无法弹出内核栈中的 Trap 上下文; 程序用不到 `x4`, 所以没必要恢复.  

    (4). `sp` 为用户栈栈顶, `sscratch` 存储内核栈栈顶.  

    (5). 状态切换发生在 `sret` 指令, 这条指令会使特权级降低一级, 在这里则是从 S 降到 U, 回到用户态.  

    (6). `sp` 为内核栈栈顶, `sscratch` 存储用户栈栈顶.  

    (7). 是在用户程序执行 `ecall` 指令时.  


### 荣誉准则
1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：
    > 无

2. 此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：
    > 无

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。